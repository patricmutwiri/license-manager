<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">

<head>
    <title>License Manager - My Licenses</title>
    <link rel="stylesheet" th:href="@{/css/main.css}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <nav>
        <div class="container">
            <a href="/" class="logo">
                <span class="logo-icon">LM</span>
                License Manager
            </a>
            <div class="nav-links">
                <a href="/">Dashboard</a>
                <a href="/logout">Logout</a>
            </div>
        </div>
    </nav>

    <main class="container">
        <header>
            <h1>Organization Licenses</h1>
            <p>View and manage active software licenses for this organization.</p>
        </header>

        <div class="grid">
            <div th:each="license : ${licenses}" class="glass-card">
                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1.5rem;">
                    <span
                        th:class="'status-badge ' + (${license.expiry != null && license.expiry.isAfter(now) ? 'status-active' : 'status-expired'})"
                        th:text="${license.expiry != null && license.expiry.isAfter(now) ? 'Active' : 'Expired'}">Active</span>
                    <span style="font-size: 0.75rem; color: var(--text-secondary);" th:text="'# ' + ${license.id}">#
                        1</span>
                </div>

                <div class="license-key-wrapper" style="margin-bottom: 1.5rem;">
                    <code th:id="'key-' + ${license.id}" th:text="${license.key}">XXXX-XXXX-XXXX-XXXX</code>
                    <button th:onclick="'copyKey(\'' + ${license.key} + '\')'"
                        style="position: absolute; top: 0.5rem; right: 0.5rem; background: transparent; border: none; color: var(--text-muted); cursor: pointer; padding: 4px;">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                        </svg>
                    </button>
                </div>

                <div
                    style="display: flex; flex-direction: column; gap: 0.5rem; color: var(--text-secondary); font-size: 0.875rem;">
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                        </svg>
                        <span
                            th:text="${license.user != null ? (license.user.name != null && !license.user.name.isEmpty() ? license.user.name : license.user.email) : 'System User'}">User
                            Name</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                        </svg>
                        <span
                            th:text="${license.expiry != null ? 'Expires: ' + #temporals.format(license.expiry, 'yyyy-MM-dd') : 'No Expiry'}">2026-01-01</span>
                    </div>
                </div>
            </div>

            <div th:if="${#lists.isEmpty(licenses)}" class="glass-card"
                style="grid-column: 1 / -1; text-align: center; padding: 4rem;">
                <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">No licenses found for this organization.
                </p>
                <a href="/" class="btn btn-primary">Back to Dashboard</a>
            </div>
        </div>

        <div style="margin-top: 3rem; text-align: center;">
            <a href="/" class="btn btn-secondary">Dashboard</a>
        </div>

        <footer style="margin-top: 5rem; border-top: 1px solid var(--border-dim); padding: 2rem 0; text-align: center;">
            <p style="color: var(--text-muted); font-size: 0.875rem;">
                Works by <a href="https://github.com/patricmutwiri" target="_blank"
                    style="color: var(--primary); text-decoration: none; font-weight: 600;">Patrick Mutwiri</a>
            </p>
        </footer>
    </main>

    <script>
        function copyKey(text) {
            navigator.clipboard.writeText(text).then(() => {
                const toast = document.createElement('div');
                toast.innerText = 'Key copied to clipboard';
                toast.style.position = 'fixed';
                toast.style.bottom = '2rem';
                toast.style.right = '2rem';
                toast.style.background = 'var(--primary)';
                toast.style.color = 'white';
                toast.style.padding = '0.75rem 1.5rem';
                toast.style.borderRadius = '8px';
                toast.style.boxShadow = '0 10px 15px -3px rgba(0, 0, 0, 0.4)';
                toast.style.zIndex = '1000';
                document.body.appendChild(toast);
                setTimeout(() => toast.remove(), 2000);
            });
        }
    </script>
</body>

</html>